---
title: "Using the MicroBioMap package"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Using the MicroBioMap package}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

## Overview

## Getting started

### Installation

```{r eval=FALSE}
library(BiocManager)
BiocManager::install('seandavi/MicroBioMap')
```

## Basic usage

```{r message=FALSE}
library(MicroBioMap)
# this operation requires about 4GB of RAM
cpd <- get_compendium()
```

```{r}
cpd
```

### Sample metadata


The `colData` slot of the `cpd` object contains the information about samples.
We can examine the names of the available metadata:

```{r}
names(colData(cpd))
```

We can look at the samples by available regions:

* Region
    ```{r}
    table(colData(cpd)$region)
    ```

* Library strategy
    ```{r}
    table(colData(cpd)$library_strategy)
    ```

* Instrument
    ```{r}
    table(colData(cpd)$instrument)
    ```

* Country
    ```{r}
    head(sort(table(colData(cpd)$country), decreasing = TRUE))
    ```


### Microbe (row) metadata

Each row in `cpd` represents one microbe. The `rowData` contains a data.frame-
like set of metadata with columns `kingdom`, `phylum`, etc. 

```{r}
head(rowData(cpd))
```

## Use cases

### Samples in specific Bioprojects

To select samples that belong to specific Bioprojects, we can filter using
the "project" metadata column in the `colData`.

```{r}
head(unique(colData(cpd)$project))
```

For example, create a subset of data belonging to Bioprojects:

- PRJDB10485
- PRJDB10527
- PRJDB10528
- PRJDB10612

```{r}
project_ids <- c("PRJDB10485", "PRJDB10527", "PRJDB10528", "PRJDB10612")
cpd_sub_by_project_ids <- cpd[,colData(cpd)$project %in% project_ids]
cpd_sub_by_project_ids
```

### Samples from a specific world region

To select a subset of samples from a specific world region, subset by the
"columns" of the dataset. The following code ummarized the regions are 
available and the number of samples in each region.

```{r}
sort(table(colData(cpd)$region), decreasing = TRUE)
```
Now, select only those samples from, for example, "Sub-Saharan Africa".

```{r}
cpd_africa <- cpd[,colData(cpd)$region=='Sub-Saharan Africa']
cpd_africa
```

### Histogram of total bases per sample

```{r warning=FALSE, message=FALSE}
library(ggplot2)
ggplot(as.data.frame(colData(cpd)), aes(x=log10(total_bases))) + geom_histogram()
```

### Read counts aggregated to *Order*

- [ ] TODO

### Samples filtered by presence of microbe

- [ ] TODO

## sessionInfo

```{r}
sessionInfo()
```
